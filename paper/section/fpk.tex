\section{Fokker-Planck-Kolmogorov Equation}
\subsection{FPK Equation}
\begin{definition}[Generator]
    The infinitesimal generator of a stochastic process $X(t)$ for function $\phi(x)$, i.e. $\phi(X_t)$ can be defined as
    \begin{equation}
        \mathcal{A} \phi(X_t)=\lim _{s \rightarrow 0^{+}} \frac{E[\phi(X(t+s)]-\phi(X(t))}{s}
    \end{equation}
    Where  $\phi$  is a suitable regular function.
\end{definition}
This leads to Dynkin's Formula very naturally.
\begin{theorem}[Dynkin's Formula]
    \begin{equation}
        E[f(X_t)]=f(X_0)+E\left[\int_0^t\mathcal{A}(f(X_s))ds\right]
    \end{equation}
\end{theorem}

\begin{theorem}
    If  $X(t)$  s.t. \ref{sde}, then the generator is given:
\begin{equation}
    \mathcal{A}(\cdot)=\sum_{i} \frac{\partial(\cdot)}{\partial x_{i}} f_{i}(X_t, t)+\frac{1}{2} \sum_{i, j}\left(\frac{\partial^{2}(\cdot)}{\partial x_{i} \partial x_{j}}\right)\left[G(X_t, t)Q G^{\top}(X_t, t)\right]_{i j}
\end{equation}
\end{theorem}
\begin{proof}
    See P119 of SDE by Oksendal.
\end{proof}

\begin{example}
    If $dX_t=dW_t$, then $\mathcal{A}=\frac{1}{2}\Delta$, where $\Delta$ is the Laplace operator.
\end{example}

\begin{definition}[Generalized Generator]
    For $\phi(x, t)$, i.e. $\phi(X_t, t)$, the generator can be defined as:
    \begin{equation}
        A_{t} \phi(x, t)=\lim _{s \rightarrow 0^{+}} \frac{E[\phi(X(t+s), t+s)]-\phi(X(t), t)}{s}
    \end{equation}
\end{definition}

\begin{theorem}
    Similarly if $X(t)$ s.t. \ref{sde}, then the generalized generator is given:
    \begin{equation}
        \mathcal{A}_{t}(\cdot)=\frac{\partial(\cdot)}{\partial t}+\sum_{i} \frac{\partial(\cdot)}{\partial x_{i}} f_{i}(X_t, t)+\frac{1}{2} \sum_{i, j}\left(\frac{\partial^{2}(\cdot)}{\partial x_{i} \partial x_{j}}\right)\left[G(X_t, t) Q G^{\top}(X_t, t)\right]_{i j}
    \end{equation}
\end{theorem}
We want to consider the density distribution of $X_t, P(x, t)$
\begin{theorem}[Fokken-Planck-Kolmogorov equation]
    The density function $P(x, t)$ of $X_t$ s.t. \ref{sde} solves the PDE:
    \begin{equation}
        \frac{\partial P(x, t)}{\partial t}=-\sum_{i} \frac{\partial}{\partial x_{i}}\left[f_{i}(x, t) p(x, t)\right]+\frac{1}{2} \sum_{i, j} \frac{\partial^{2}}{\partial x_{i} \partial x_{j}}\left[\left(G Q G^{\top}\right)_{i j} P(x, t)\right]
    \end{equation}
    The PDE is called FPK equation / forwand Kolmogorov equation.
\end{theorem}
\begin{proof}
    Consider the function $\phi(x)$, let $x=X_t$ and apply Ito's Formula:
    \begin{equation}
        \begin{aligned}
            d \phi & =\sum_{i} \frac{\partial \phi}{\partial x_{i}} d x_{i}+\frac{1}{2} \sum_{i, j}\left(\frac{\partial^{2} \phi}{\partial x_{i} \partial x_{j}}\right) d x_{i} d x_{j} \\
            & =\sum_{i} \frac{\partial \phi}{\partial x_{i}}\left(f_{i}\left(X_t, t\right) d t+\left(G\left(X_{t}, t\right) d W_{t}\right)\right)+\frac{1}{2} \sum_{i, j}\left(\frac{\partial^{2} \phi}{\partial x_{i} \partial x_{j}}\right)\left[G(X_t, t) Q G^{\top}(X_t, t)\right]_{i j} d t .
            \end{aligned}
    \end{equation}
    Take expectation of both sides:
    \begin{equation}\label{expectation}
        \frac{d E[\phi]}{d t}=\sum_{i} E\left[\frac{\partial \phi}{\partial x_{i}} f_{i}(X_t, t)\right]+\frac{1}{2} \sum_{i j} E\left[\frac{\partial^{2} \phi}{\partial x_{i} \partial x_{j}}\left[G Q G^{\top}\right]_{i j}\right]
    \end{equation}
    So 
    \begin{equation}\left\{
        \begin{aligned}
            &\frac{d E[\phi]}{d t} =\frac{d}{d t}\left[\int \phi(x) P(X_t=x, t) d x\right]=\int \phi(x) \frac{\partial P(x, t)}{\partial t} dx\\
            &\sum_{i} E\left[\frac{\partial \phi}{\partial x_{i}} f_{i}\right]=\sum_{i} \int\frac{\partial \phi}{\partial x_{i}} f_{i}(X_t=x, t) P d x
            =-\sum_{i} \int \phi \cdot \frac{\partial}{\partial x_{i}}\left[f_{i}(x, t) p(x, t)\right] d x . \\
            &\frac{1}{2} \sum_{i j} E\left[\frac{\partial^{2} \phi}{\partial x_{i} \partial x_{j}}\left[G Q G^{\top}\right]_{i j}\right]=\frac{1}{2} \sum_{i j} \int \frac{\partial^{2} \phi}{\partial x_{i} \partial x_{j}}\left[G Q G^{\top}\right]_{i j} P d x
            =\frac{1}{2} \sum_{i j} \int \phi(x) \frac{\partial^{2}}{\partial x_{i} \partial x_{j}}\left(\left[G Q G^{\top}\right]_{i j} P\right) d x. \\
        \end{aligned}\right.
    \end{equation}
    then
    $$\int \phi  \frac{\partial P}{\partial t} d X=-\sum_{i} \int \phi  \frac{\partial}{\partial x_{i}}\left(f_{i} P\right) d X+\frac{1}{2} \sum_{i j} \int \phi \frac{\partial^{2}}{\partial x_{i} x_{j}}\left(\left[G Q G^{\top}\right]_{i j} P\right) d x$$
    Hence $$\int \phi \cdot\left[\frac{\partial P}{\partial t}+\sum_{i} \frac{\partial}{\partial x_{i}}\left(f_{i} P\right)-\frac{1}{2} \sum_{i j} \frac{\partial^{2}}{\partial x_{i} \partial x_{j}}\left(\left[G Q G^{\top}\right]_{i j} P\right)\right] d X=0$$
    Therefore P s.t.    
    \begin{equation}
        \frac{\partial P}{\partial t}+\sum_{i} \frac{\partial}{\partial x_{i}}\left(f_{i}(x, t) P(x, t)\right)-\frac{1}{2} \sum_{i=1} \frac{\partial^{2}}{\partial X_{i} \partial X_{j}}\left(\left[G Q G^{\top}\right]_{i j} P\left(x,t\right)\right)=0
    \end{equation}
    Which gives the FPK Equation.
\end{proof}

\begin{remark}
    When SDE is time independent:  
    \begin{equation}
        d X_t=f(X_t) d t+G(X_t) d W_{t}  
    \end{equation}
    then the solution of FPK often converges to a stationary solution s.t.  $\frac{\partial P}{\partial t}=0$.
\end{remark}
Here is an another way to show FPK equation: Since we have inner product $\langle\phi, \psi\rangle=\int \phi(x)\psi(x)dx$. Then $E[\phi(x)]=\langle\phi, P\rangle$.

As the equation \ref{expectation} can be written as 
\begin{equation}
    \frac{d}{dt}\langle\phi, P\rangle=\langle\mathcal{A}\phi, P\rangle
\end{equation}
Where $\mathcal{A}$ has been mentioned above. If we note the adjoint operator of $\mathcal{A}$ as $\mathcal{A}^*$, then we have
\begin{equation}
    \langle\phi, \frac{dP}{dt}-\mathcal{A}^*(P)\rangle=0,\forall \phi(x)
\end{equation}
Hence we have 
\begin{theorem}[FPK Equation]
    \begin{equation}
    \frac{dP}{dt}=\mathcal{A}^*(P),\operatorname{where} \mathcal{A}^*(\cdot)=-\sum_{i} \frac{\partial}{\partial x_{i}}\left(f_{i}(x, t) (\cdot)\right)+\frac{1}{2} \sum_{i=1} \frac{\partial^{2}}{\partial x_{i} \partial x_{j}}\left(\left[G Q G^{\top}\right]_{i j}(\cdot)\right)
\end{equation}
It can be rewritten as:
\begin{equation}
    \begin{aligned}
        \frac{\partial P}{\partial t} &= -\nabla\cdot\left[f(x, t) p(x, t)\right]+\frac{1}{2} \nabla^2\cdot\left[\left(G Q G^{\top}\right) p(x, t)\right] \\
        &=-\nabla\cdot\left[f(x, t) p(x, t)-\frac{1}{2} \nabla\cdot\left[\left(G Q G^{\top}\right) p(x, t)\right]\right]
    \end{aligned}
\end{equation}
\end{theorem}

\begin{theorem}[Transition Density(Forward Komogorov Equation)]
     The transition density $P_{t|s}(x_t|x_s),t\geq s$, which means the propability of transition from $X(s)=x_s$ to $X(t)=x_t$, satisfies the FPK equation with initial condition $P_{s|s}(x|x_s)=\delta(x-x_s)$
     i.e. for $P_{t|s}(x|y)$, it solves
     \begin{equation}
        \frac{\partial P_{t|s}(x|y)}{\partial t}=\mathcal{A}^*(P_{t|s}(x|y)), \operatorname{with} P_{s|s}(x|y)=\delta(x-y)
     \end{equation}
\end{theorem}

\begin{theorem}[Backward Komogorov Equation]
    $P_{s|t}(y|x)$ for $t\geq s$ solves:
    \begin{equation}
        \frac{\partial P_{s|t}(y|x)}{\partial s} + \mathcal{A}(P_{s|t}(y|x))=0, \operatorname{ with }P_{s|t}(y|x) = \delta(x-y)
    \end{equation}
\end{theorem}
\subsection{Langevin SDE}
The Langevin SDE has the following form:
\begin{equation}
    X_{t + s} = X_t + \nabla \log p_t(x_t)s + \sqrt{2s}\xi
\end{equation}
where $X_t\in \mathcal{R}^d, p_t(x_t)=p(X_t=x_t)$, $\xi\sim N(0, I)$, $I$ is identical matrix of $m \times m$. Our goal is to sample from specific $p(x, t)$.

\begin{theorem}
    The density of Langevin Diffusion Model converges to $p(x)$ over time. In other words, if $X_t\sim p(x)$, then $X_{t+s}\sim p(x)$ for $\forall s>0$. 
\end{theorem}
\begin{proof}
    Let  $\mu_{t}(f)=E\left[f\left(X_{t}\right)\right]$. Consider  $\mu_{t+\tau}(f)=E\left[f\left(X_{t+\tau}\right)\right]$, as $\tau \rightarrow 0$. Then  
\begin{equation}
    \begin{aligned}
        \mu_{t+\tau}=&E\left[f\left(X_{t}+\nabla \log p_t\left(x_{t}\right) \cdot \tau+\sqrt{2 \tau} \xi\right)\right]\\
        =&E\left[f\left(x_{t}\right)+\nabla^{\top} f\left(x_{t}\right)\left(\tau \nabla \log p_t\left(x_{t}\right)+\sqrt{2 \tau} \xi\right)\right. \\
        &+\frac{1}{2}\left.\left(\nabla^{\top}\log p_t(x_t)\tau + \sqrt{2\tau}\xi\right)\nabla^2f(x_t)\nabla\log p_t(x_t)\tau + \sqrt{2\tau}\xi\right]\\
        =&E\left[f\left(x_{t}\right)\right]+E\left[\tau \nabla^{\top}f\left(x_{t}\right) \nabla \log p_t\left(x_{t}\right)\right]\\
        &+\frac{\tau^{2}}{2} E\left[\nabla^{\top} \log p\left(x_{t}\right) \cdot \nabla^{2} f\left(x_{t}\right) \cdot \nabla \log p\left(x_{t}\right)\right] +E\left[\tau \xi^{\top} \nabla^{2} f\left(x_{t}\right) \xi\right]
    \end{aligned}
\end{equation}
 
The second term:
\begin{equation}
    \begin{aligned}
        &\tau E\left[\nabla^{\top} f \nabla \log p_{t}\right] \\
        =&\tau \int \nabla f \cdot \nabla \log p_{t} p_{t} d x=\tau \int \nabla f \cdot \nabla p_{t} d x \\
        =&-\tau \int \operatorname{tr}\left(\nabla^{2} f\right) \cdot p_{t} d x=-\tau E\left[\operatorname{tr}\left(\nabla^{2} f\right)\right]\\
        =&-\tau E\left[\xi^{\top} \nabla^{2} f \xi\right] \\
    \end{aligned}
\end{equation}
Then 
\begin{equation}
    \mu_{t+\tau} =E\left[\frac{1}{2} \nabla^{\top} \log p_{t} \nabla^{2} f \nabla \log p_{t}\right] \cdot \tau^{2}=O\left(\tau^{2}\right)
\end{equation}
Hence we have $\frac{d}{dt}(\mu_t)=0$, i.e. $E[\mu_t]=E[\mu_{t+s}]$ for $\forall s>0$.
\end{proof}

\begin{remark}
    We define the density of normal distribution $N(x ; \mu, \Sigma)$, and its log-density, gradient of density and score as follows:
    \begin{equation}\left\{
        \begin{aligned}
            &N(x ; \mu, \Sigma)=\frac{1}{\sqrt{(2 \pi)^{d}|\Sigma|}} e^{-\frac{1}{2}(x-\mu)^{\top} \Sigma^{-1}(x-\mu)}\\
            &\log N(x ; \mu, \Sigma)=-\frac{1}{2}(x-\mu)^{\top} \Sigma^{-1}(x-\mu)-\log \left(\sqrt{(2 \pi)^{d}|\Sigma|}\right) . \\
            &\nabla_{x} N(x ; \mu, \Sigma)=N(x ; \mu, \Sigma)\Sigma^{-1}(x-\mu) \\
            &\nabla_{x} \log N(x ; \mu, \Sigma)=-\Sigma^{-1}(x-\mu) .
        \end{aligned}\right.
    \end{equation}
\end{remark}

Actually, Langevin SDE is not necessary be as above i.e. the diffusion term is not necessary to be $\sqrt{2}$. The reason is to guarantee the stationary distribution of $p_t(x)$.
i.e. the term $\frac{\partial p(x,t)}{\partial t}=0$ in FPK equation. If the diffusion term is $g(t)$, then by FPK equation, we have 
$$\nabla_x\cdot(fp-\frac{1}{2}g^2(t)\nabla p)=0$$
then $f(x,t) = \frac{1}{2}g^2(t)\frac{\nabla_x p(x, t)}{p(x,t)}=\frac{1}{2}g^2(t)\nabla_x\log p(x, t)$.

